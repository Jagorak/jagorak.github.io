<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <title>Title</title>
        
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300..800;1,300..800&display=swap" rel="stylesheet">
		
		<link rel="preconnect" href="https://fonts.googleapis.com">
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
		<link href="https://fonts.googleapis.com/css2?family=Cal+Sans&display=swap" rel="stylesheet">
        
        <style>
            * {
                margin: 0;
                padding: 0;
                font-family: "Open Sans";
            }
			
			body {
				background: #e0effc;
			}
			
			#thumbnail {
				display: inline-block;
			}
			
			#summary {
				display: inline-block;
			}
			
			#binder {
				margin: 0 auto;
				width: 700px;
				display: none;
				height: 70px;
			}
			
			#title {
				font-weight: bold;
				font-size: 20px;
				padding-bottom: 2px;
				border-bottom: 1px solid #000;
				margin-top: 4px;
				font-family: "Open Sans";
				padding-left: 14px;
			}
			
			a {
				color: #000;
				text-decoration: none;
			}
			
			.header {
				font-family: "Cal Sans";
				font-weight: bold;
				font-size: 40px;
				color: #e0effc;
				background: #000;
				padding: 0px 10px 0px 10px;
			}
        </style>
        
        <script type="text/javascript">
			//https://developers.google.com/blogger/docs/3.0/reference/posts#resource
			
            let blog = {
                id: "2354829316788835637",
                key: "AIzaSyBcZI6ecgH2-nh80_AnmTC4HPPO2XYgFPc"
            };
			
			let parser = new DOMParser();
            
			window.addEventListener("load", () => {
                let request = new Request(
					"https://www.googleapis.com/blogger/v3/blogs/" + blog.id + "/posts?fetchImages=true&key=" + blog.key
				);
                
				fetch(request).then((response) => {
					response.json().then((data) => {
						printPostList(data);
					});
				});
            }, false);
			
            function printPostList(data){
                let canvas = new OffscreenCanvas(70, 70);
				let ctx = canvas.getContext("2d", {willReadFrequently: true});
				
                for(let post of data.items){
                    let binder = document.querySelector("#binder").cloneNode(true);
                    
                    binder.querySelector("#title").innerText = post.title;
                    binder.style.display = "block";
					
					document.body.appendChild(binder);
					
					let html = parser.parseFromString(post.content, "text/html");
					let img = binder.querySelector("#thumbnail");
					
					if(post.images[0].url){
						fetch(post.images[0].url)
							.then((response) => {
								return response.blob();
							})
							.then((imgBlob) => {
								img.src = URL.createObjectURL(imgBlob);
							});
					}
					
					img.addEventListener("load", ()=>{
						ctx.drawImage(img, 0, 0, 70, 70);
						
						let pixels = ctx.getImageData(0, 0, canvas.width, canvas.height);
						
						let r = 0;
						let g = 0;
						let b = 0;
						
						for(let i = 0; i < pixels.data.length; i += 4){
							r += pixels.data[i];
							g += pixels.data[i+1];
							b += pixels.data[i+2];
						}
						
						r = parseInt(r / 4900);
						g = parseInt(g / 4900);
						b = parseInt(b / 4900);
						
						let hexCode = "#" + r.toString(16) + g.toString(16) + b.toString(16);
						
						binder.addEventListener("mouseover", () => binder.style.background = "linear-gradient(to right, " + hexCode + ", transparent)");
						binder.addEventListener("mouseout", () => binder.style.background = "none");
					}, false);
					
					let text = html.querySelector("p");
					if(text) binder.querySelector("#intro").innerText = text.innerText;
					
					for(let link of binder.querySelectorAll("A")){
						link.href = link.href + "?id=" + post.id;
					}
                }
            }
            
            function getSpecificPost(){
                let request = new XMLHttpRequest();
                
                request.open("GET", "https://www.googleapis.com/blogger/v3/blogs/" + blog.id +"/posts?key=" + blog.key, true);
                request.send();
                
                request.onreadystatechange = () => {
                    //if(request.readyState == 4) console.log(request.response);
                }
            }
        </script>
    </head>
    <body>
		<div style="width: 700px; margin: 0 auto; padding: 10px; text-align: center"><span class="header">Technology</span></div>
		<div style="width: 700px; margin: 0 auto; padding: 10px; text-align: center"><span class="header">3D</span></div>
		<div style="width: 700px; margin: 0 auto; padding: 10px; text-align: center"><span class="header">Animation</span></div>
		<div style="width: 700px; margin: 0 auto; padding: 10px; text-align: center"><span class="header">Art</span></div>
		
		<div id="binder" style="position: relative">
			<a href="post.htm">
			<img id="thumbnail" width="70px" height="70px"/>
			<div id="summary" style="width: 610px; vertical-align: top;">
				<p id="title"></p>
				<p id="intro" style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis; margin-top: 7px; margin-left: 14px;"></p>
			</div>
			<div style="border-bottom: 10px solid transparent; border-left: 10px solid #f00; display: inline-block; position: absolute; left: 0px"></div>
			<div style="border-bottom: 10px solid transparent; border-right: 10px solid #f00; display: inline-block; position: absolute; right: 0px; top: 0px"></div>
			</a>
		</div>
    </body>
</html>
